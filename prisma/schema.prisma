generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  email     String    @unique
  password  String
  phone     String?
  address   String?
  role      Role
  createdAt DateTime  @default(now())
  demandes  Demande[] // 1 user → N demandes
  dossiersEtude DossierEtude[] // ✅ relation inverse
}

model Demande {
  id          Int         @id @default(autoincrement())
  titre       String
  ville       String
  adresse     String
  type        TypeDemande
  description String
  status      StatusDemande @default(EN_ATTENTE)
  remarques   String?
  createdAt   DateTime    @default(now())
  clientId    Int
  client      User        @relation(fields: [clientId], references: [id])
  documents   Document[]  // 1 demande → N documents
  
  dossierEtude DossierEtude? // ✅ Relation 1:1 inverse
}

model Document {
  id         Int      @id @default(autoincrement())
  filename   String
  path       String   // ex: /uploads/file.pdf
  uploadedAt DateTime @default(now())
  demandeId  Int
  demande    Demande  @relation(fields: [demandeId], references: [id])
  dossierEtudeId Int?          // ← clé étrangère facultative
  dossierEtude   DossierEtude? @relation(fields: [dossierEtudeId], references: [id])
}

model DossierEtude {
  id         Int              @id @default(autoincrement())
  createdAt  DateTime         @default(now())
  remarques  String?
  status     StatusDossierEtude @default(EN_COURS)
  clientId   Int
  demandeId  Int @unique

  client     User             @relation(fields: [clientId], references: [id])
  demande    Demande          @relation(fields: [demandeId], references: [id])
  documents  Document[]       // 1 dossier → N documents
}

enum StatusDossierEtude {
  EN_COURS
  ACCEPTEE
  A_CORRIGER
}


enum Role {
  CLIENT
  RESPONSABLE_AEP
  RESPONSABLE_ASSEU
  DIRECTEUR
}

enum TypeDemande {
  AEP
  ASSEU
  LES_DEUX
}

enum StatusDemande {
  EN_ATTENTE
  EN_ETUDE
  ACCEPTEE
  A_CORRIGER
}



